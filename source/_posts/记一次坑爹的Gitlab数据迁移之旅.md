title: 记一次坑爹的Gitlab数据迁移之旅
date: 2017-12-12 11:45:05
tags:
  - CentOS
  - Docker
  - Gitlab
categories: 运维
---
昨晚加班到两点，为了完成公司开发环境的Gitlab迁移，以便在从今天开始所有人都能在新的Gitlab上工作。迁移的原因是之前错误的估计了Gitlab的系统资源占用率，在一台比较繁忙的服务器上搭建了Gitlab，服务器配置只有单核4G内存，还运行了Jenkins和Nginx等其他服务，导致Gitlab在繁忙时经常响应缓慢或无响应，因此有了这次迁移之旅，期间踩坑无数，不过也学到了很多关于CentOS和Docker的知识。
<!--more-->
其实最初我希望使用[Gogs](https://gogs.io/)来替代Gitlab，原因是测试环境服务器资源着实有限，单核4G的虚拟机，运行Gitlab大约要占1.5-2G内存，加上CentOS本身和其他应用的内存占用，空闲内存只剩下不到100MB，很多时候系统响应非常缓慢，严重影响了团队的开发效率。而Gogs由于不会默认内置Nginx和PostgreSQL等应用，所以启动后只会占用几百兆内存，差距还是非常明显的。但是在试用之后，我觉得Gogs还是不够成熟，例如：最新版本对MySQL版本要求过高（5.7），SSH支持不友好（甚至存在bug），权限设计模型（针对单个工程设置白名单，而不像Gitlab那样有明确的角色体系），以及整体用户体验综合考虑，所以最终还是弃用了。